<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Biblioteca ðŸ“š</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-r from-indigo-200 via-purple-200 to-pink-200 flex flex-col items-center p-6">

  <h1 class="text-4xl font-bold mb-6">ðŸ“š Biblioteca Virtual</h1>

  <!-- Contador -->
  <div class="mb-4 p-3 bg-white shadow rounded-xl">
    <span id="contador" class="text-lg font-semibold text-gray-700">Total de livros: 0</span>
  </div>

  <!-- FormulÃ¡rio -->
  <form id="livroForm" class="bg-white p-6 rounded-xl shadow-md w-full max-w-lg space-y-3">
    <input id="titulo" type="text" placeholder="TÃ­tulo" class="w-full p-2 border rounded-lg" required>
    <input id="autor" type="text" placeholder="Autor" class="w-full p-2 border rounded-lg" required>
    <input id="ano" type="number" placeholder="Ano" class="w-full p-2 border rounded-lg">
    <textarea id="descricao" placeholder="DescriÃ§Ã£o" class="w-full p-2 border rounded-lg"></textarea>
    <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 w-full">Adicionar</button>
  </form>

  <!-- Tabela -->
  <table class="mt-6 w-full max-w-5xl bg-white shadow rounded-xl overflow-hidden">
    <thead class="bg-indigo-500 text-white">
      <tr>
        <th class="p-2">TÃ­tulo</th>
        <th class="p-2">Autor</th>
        <th class="p-2">Ano</th>
        <th class="p-2">DescriÃ§Ã£o</th>
        <th class="p-2">AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody id="tabelaLivros" class="divide-y">
      <!-- Linhas preenchidas pelo JS -->
    </tbody>
  </table>

  <script>
    // Ajuste o link da API para sua Vercel
    const API = "https://biblioteca-vercel-organizada-ckzn.vercel.app/api/livros";

    const form = document.getElementById("livroForm");
    const tabela = document.getElementById("tabelaLivros");
    const contador = document.getElementById("contador");
    let editandoId = null;

    async function carregarLivros() {
      const res = await fetch(API);
      const livros = await res.json();
      tabela.innerHTML = "";
      livros.forEach(livro => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="p-2">${livro.titulo}</td>
          <td class="p-2">${livro.autor}</td>
          <td class="p-2">${livro.ano || ""}</td>
          <td class="p-2">${livro.descricao || ""}</td>
          <td class="p-2 flex gap-2">
            <button onclick="editarLivro(${livro.id}, '${livro.titulo}', '${livro.autor}', '${livro.ano || ""}', '${livro.descricao || ""}')" 
              class="bg-yellow-400 text-white px-2 py-1 rounded">Editar</button>
            <button onclick="deletarLivro(${livro.id})" 
              class="bg-red-500 text-white px-2 py-1 rounded">Excluir</button>
          </td>
        `;
        tabela.appendChild(tr);
      });
      contador.textContent = `Total de livros: ${livros.length}`;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const novoLivro = {
        titulo: document.getElementById("titulo").value,
        autor: document.getElementById("autor").value,
        ano: document.getElementById("ano").value,
        descricao: document.getElementById("descricao").value
      };

      if (editandoId) {
        await fetch(`${API}/${editandoId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(novoLivro)
        });
        editandoId = null;
      } else {
        await fetch(API, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(novoLivro)
        });
      }

      form.reset();
      carregarLivros();
    });

    async function deletarLivro(id) {
      await fetch(`${API}/${id}`, { method: "DELETE" });
      carregarLivros();
    }

    function editarLivro(id, titulo, autor, ano, descricao) {
      document.getElementById("titulo").value = titulo;
      document.getElementById("autor").value = autor;
      document.getElementById("ano").value = ano;
      document.getElementById("descricao").value = descricao;
      editandoId = id;
    }

    carregarLivros();
  </script>
</body>
</html>
